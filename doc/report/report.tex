% Copyright (C) 2020-2021 Diogo Rodrigues, Breno Pimentel
% Distributed under the terms of the GNU General Public License, version 3

\documentclass[runningheads]{llncs}

\usepackage{graphicx}
% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
% \renewcommand\UrlFont{\color{blue}\rmfamily}

\usepackage[binary-units=true]{siunitx} %SI units

\begin{document}
\title{TuCoTuTeCo}
\subtitle{Allocating students to classes during COVID-19}
%
%\titlerunning{Abbreviated paper title}
% If the paper title is too long for the running head, you can set
% an abbreviated paper title here
%
\author{Diogo Miguel Ferreira Rodrigues (\email{diogo.rodrigues@fe.up.pt})\inst{1},\\
Breno Accioly de Barros Pimentel (\email{up201800170@fe.up.pt})\inst{1}}

\authorrunning{D. Rodrigues and B. Pimentel}

\institute{
Faculty of Engineering -- University of Porto, Portugal\\
PLOG -- Class 3MIEIC02, Group TuCoTuTeCo\_4
}
%
\maketitle              % typeset the header of the contribution
%
\begin{abstract}
The abstract should briefly summarize the contents of the paper in
150--250 words.

\keywords{
First keyword \and
Second keyword \and
Another keyword.}
\end{abstract}

\section{Introduction}

Student--class allocation is a routine problem for educational institutions, and is usually solved as a constrainted resource allocation problem where classes are the resources, the agents are the students and subject to constraints such as a student not having overlapping classes of different subjects and balancing class sizes.
However, as a result of the COVID-19 pandemic, further constraints must be applied to increase physical distancing and reduce the number of contacts, such as more strongly enforcing class balancing, and also balancing the number of students with even and odd ID number in a class so students with even and odd IDs can have presential classes in alternating weeks.

We will thus model this problem as a constraint optimization problem (COP) with a set of soft and hard constraints, and provide it with a value function that should be optimized.
We encoded the problem as a Prolog program using SICStus Prolog and the constraint logic programming (CLP) module \texttt{clpfd} (\textit{CLP over Finite Domains}), with an interface to solve an instance of the problem.
We then generate a set of different scenarios with varying dimensions to analyse the time complexity of the solution.
Finally we present the results of our experiments.

\section{Problem description}

Consider an educational institution which lectures $|S|$ subjects numbered $s=1, 2, ... , |S|$ ($S = \{1, 2, ..., |S|\}$ is the set of subjects), where subject $s$ has $|C^s|$ classes numbered $c=1, 2, ..., |C^s|$ ($C^s = \{1, 2, ..., |C^s|\}$ is the set of classes of subject $s$).

That institution has a set of students with ID $i$, and for each student it is known his average grade from past school years $0 \leq g^i \leq 20$, the subjects he is enrolled in subjects sequence $S^i = \langle S^i_1, S^i_2, ..., S^i_{|S^i|} \rangle$, $S^i_k \in S$ and his chosen schedule options $O^i = \{o^i_1, o^i_2, ..., o^i_{|S^i|}\}$ where $3 \geq N_i \geq 6$ is the number of schedule options the student chose, and $o^i_j$ is the $j$-th option of student $i$, where an option is $o^i_j = \langle c^i_{j, 1}, c^i_{j, 2}, ..., {c^i_{j, |S_i|}} \rangle$, where $c^i_{j,k}$ is the class student $i$ selected for his/her $j$-th option and subject $S^i_k$.

$O^i = \langle o^i_1, o^i_2, ..., o^i_{|S^i|} \rangle$ can otherwise be a sequence of options, where student $i$'s preferred option is $o^i_1$ and his/her least preferred option is $o^i_ {|S^i|}$.

The solution is, for each student $i$, an empty schedule $a^i=\langle \rangle$ if he/she was not allocated, or the allocated schedule $a^i = \langle a^i_1, a^i_2, ..., a^i_{|S_i|} \rangle$ if he was allocated.

The restrictions are as follows:
\begin{enumerate}
    \item Students must be placed in decreasing order of their grades.
    \item A student must be either allocated to a schedule (may it be one of his/her options or not), or not allocated to any of his/her subjects.
    \item (\textit{Optional}) A student does not have overlapping classes of different subjects.
    \item The number of students per class in a subject must be close to the average number of students per class in that subject.
    \item The ratio of odd-numbered students to even-numbered students in the classes of a subject should be balanced (i.e., close to 1, or close to the odd-even ratio for that subject).
    \item (\textit{Optional}) Students should be allocated preferrably to their first options when possible.
\end{enumerate}

\section{Approach}

\subsection{Data}

The input data is made of:
\begin{enumerate}
    \item Facts using the predicate \texttt{schedule(Subject, Class, Time)}, which means class \texttt{Class} of subject \texttt{Subject} is attending a lecture at time \texttt{Time}. To simplify without loss of generality, subjects are numbered sequentially starting in 1, classes of a subject are numbered sequentially starting in 1, and time is an integer representing a time slot (for instance, time can be divided into $\SI{30}{\minute}$ slots where the first slot is on Monday from 00:00 to 00:30). This representation of time is merely a convenient way to understand time, as the only thing that matters is the boolean relation that states if two subject-class pairs overlap.
    \item Facts using the predicate \texttt{student(ID, Grade, Subjects, Options)}, which means student with ID \texttt{ID} has average grade \texttt{Grade} is enrolled in the subjects \texttt{Subjects} which is a list, and has chosen the options  \texttt{Options} which is a list of 3 to 6 schedule options, with each element being a list of the same size as \texttt{Subjects} containing the classes chosen for the respective option.
    \item Fact using the predicate \texttt{capacity(Capacity)}, which \texttt{Capacity} means the maximum students attending to a class simultaneously.
\end{enumerate}

For each ID in \texttt{student}, there should be a fact \texttt{grade} reporting the grade of that student.

\subsection{Decision variables}

For each student and for each subject that student is enrolled, his class is outputted. The domain of the class is the set of classes a subject has as stated in facts using predicate \texttt{schedule}.

\subsection{Constraints}

\subsubsection{Hard constraints}
\begin{enumerate}
    \item A student is either completely allocated to one of his/her chosen schedules, or not allocated at all (\textit{optional}: a student can be allocated another schedule different from any of the student's choices).
    \item (\textit{Optional}) A student does not have overlapping classes in his/her allocated schedule.
    \item The number of students in a class does not exceed the maximum capacity.
\end{enumerate}

\subsubsection{Soft constraints}
\begin{enumerate}
    \item Students are placed in decreasing order of their grades (i.e., the penalty for not placing a student in one of his options, or placing him/her in the most preferred option, is greater if his grade is larger).
    \item The number of students per class in a given subject is balanced.
    \item The number of students of even and odd number in a given class-subject is balanced.
    \item (\textit{Optional}) Students should be allocated to their preferred schedules by order, where the first schedule option is the student's preferred and the last one the least preferred.
\end{enumerate}

\subsection{Evaluation function}

In order to find the best solution to the problem, we defined which constraints have a higher priority for the final result.

In this function we first consider the balance between students of even and odd IDs. Here we try that every even student in a class can make a pair with a odd student.
In case this is not possible, we choose the option where the ratio between odd and even students is closer to 1. 

We then verify, but with lower priority, if the number of students in a class of given subject is balanced in respect to the other classes of this subject.

\section{Solution presentation}

\section{Experiments and results}

\subsection{Dimensional analysis}

\subsection{Search strategies}

\section{Conclusions and future work}

%
% ---- Bibliography ----
%
% BibTeX users should specify bibliography style 'splncs04'.
% References will then be sorted and formatted in the correct style.

\bibliographystyle{llncs2e/splncs04}
\bibliography{report}

\end{document}
